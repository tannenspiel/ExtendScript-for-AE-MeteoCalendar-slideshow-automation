# Список функций - MeteoCalendarAnim v1.3

**Всего функций:** 41 (+4 новых в v1.3, включая `findProjectFolder`)

## Утилиты и инфраструктура

### `log(message, type)`
- **Назначение:** Логирование сообщений в консоль и файл
- **Параметры:** `message` (строка), `type` (строка, опционально)
- **Возвращает:** ничего
- **Использование:** Повсеместно для логирования операций

### `safeExecute(funcName, func, args)`
- **Назначение:** Безопасное выполнение функций с обработкой ошибок
- **Параметры:** `funcName` (строка), `func` (функция), `args` (массив аргументов)
- **Возвращает:** результат выполнения функции или `null` при ошибке
- **Использование:** Обертка для всех критических операций
- **НОВОЕ в v1.3:** 
  - Добавлена валидация объектов AE в debug режиме
  - Добавлено автоматическое профилирование через `PerfTimer`

### `resolvePath(relativePath)`
- **Назначение:** Преобразование относительных путей в абсолютные
- **Параметры:** `relativePath` (строка)
- **Возвращает:** абсолютный путь (строка)
- **Использование:** При работе с путями к файлам и папкам

### `escapePath(path)`
- **Назначение:** Экранирование путей для безопасного использования в BAT-файлах
- **Параметры:** `path` (строка)
- **Возвращает:** экранированный путь (строка)
- **Использование:** При создании BAT-файлов для очистки папок

### `normalizeAndValidatePath(path)`
- **Назначение:** Нормализация и валидация пути для безопасного использования в BAT-файлах
- **Параметры:** `path` (строка)
- **Возвращает:** нормализованный абсолютный путь (строка)
- **Выбрасывает:** `Error` если путь небезопасен
- **Проверки:**
  - Путь находится внутри проекта AE (если проект сохранен)
  - Отсутствие опасных символов (`&`, `|`, `>`, `<`, `;`, `` ` ``, `$`)
  - Нормализация через `Folder.fsName` для получения абсолютного пути
- **Использование:** При создании BAT-файлов для валидации путей перед операциями
- **НОВОЕ в v1.3:** Добавлено для улучшения безопасности BAT-файлов

### `validateFolderPath(path, shouldCreate)`
- **Назначение:** Валидация пути к папке с опциональным созданием
- **Параметры:** `path` (строка), `shouldCreate` (булево)
- **Возвращает:** валидный путь или `null`
- **Использование:** При проверке путей к рабочим папкам

## Работа с файлами и папками

### `universalCleanup(folderPath, backupPath)`
- **Назначение:** Универсальная очистка папок с бэкапом
- **Параметры:** `folderPath` (строка), `backupPath` (строка)
- **Возвращает:** ничего
- **Использование:** Основная функция очистки папок

### `cleanupWithDirectCommands(folderPath, backupPath)`
- **Назначение:** Очистка через прямые команды файловой системы
- **Параметры:** `folderPath` (строка), `backupPath` (строка)
- **Возвращает:** ничего
- **Использование:** Альтернативный метод очистки

### `clearFolder(folderPath, folderName)`
- **Назначение:** Очистка папки через ExtendScript API
- **Параметры:** `folderPath` (строка), `folderName` (строка)
- **Возвращает:** ничего
- **Использование:** Очистка конкретной папки

### `clearFolderWithCMD(folderPath, folderName)`
- **Назначение:** Очистка папки через CMD/BAT-файл
- **Параметры:** `folderPath` (строка), `folderName` (строка)
- **Возвращает:** ничего
- **Использование:** Очистка через системные команды

### `standardCleanup(folderPath, backupPath)`
- **Назначение:** Стандартная очистка с бэкапом
- **Параметры:** `folderPath` (строка), `backupPath` (строка)
- **Возвращает:** ничего
- **Использование:** Базовый метод очистки

## Работа с проектом After Effects

### `clearMeteoImageLayers()`
- **Назначение:** Удаление всех слоев MeteoImage из композиции
- **Параметры:** нет
- **Возвращает:** ничего
- **Использование:** Очистка слоев изображений

### `renameAndSortMasks()`
- **Назначение:** Переименование и сортировка масок по inPoint
- **Параметры:** нет
- **Возвращает:** `true` при успехе, `false` при ошибке
- **Использование:** Кнопка "Sort Masks"

### `clearProjectFolder()`
- **Назначение:** Очистка папки проекта
- **Параметры:** нет
- **Возвращает:** ничего
- **Использование:** Очистка временных файлов проекта

### `clearWorkFolder(deleteFolder, deleteFolderPath)`
- **Назначение:** Очистка рабочей папки
- **Параметры:** `deleteFolder` (объект FolderItem), `deleteFolderPath` (строка)
- **Возвращает:** ничего
- **Использование:** Очистка рабочей папки с изображениями

### `checkWorkFolder(checkFolder, checkedFolderPath)`
- **Назначение:** Проверка рабочей папки
- **Параметры:** `checkFolder` (объект FolderItem), `checkedFolderPath` (строка)
- **Возвращает:** ничего
- **Использование:** Валидация рабочей папки

### `copyFilesToBackup(sourceFolderPath, backupFolderPath)`
- **Назначение:** Копирование файлов в бэкап
- **Параметры:** `sourceFolderPath` (строка), `backupFolderPath` (строка)
- **Возвращает:** ничего
- **Использование:** Создание резервных копий

### `createBackupAEProject()`
- **Назначение:** Создание бэкапа проекта After Effects
- **Параметры:** нет
- **Возвращает:** ничего
- **Использование:** Резервное копирование проекта

## Импорт и размещение изображений

### `ImportImages()`
- **Назначение:** Импорт изображений в проект
- **Параметры:** нет
- **Возвращает:** ничего
- **Использование:** Кнопка "Import Image"

### `placeImageUnderMask(comp, imageItem, maskLayer, isUserSelected, warnings)`
- **Назначение:** Размещение изображения под маской
- **Параметры:** `comp` (CompItem), `imageItem` (FootageItem), `maskLayer` (Layer), `isUserSelected` (булево), `warnings` (массив)
- **Возвращает:** ничего
- **Использование:** Основная функция размещения изображений

### `findFreeMaskNew(comp)`
- **Назначение:** Поиск свободной маски для размещения изображения
- **Параметры:** `comp` (CompItem)
- **Возвращает:** объект Layer или `null`
- **Использование:** Автоматический поиск маски при размещении

### `removeIncorrectImageLayers(comp)`
- **Назначение:** Удаление некорректных слоев изображений
- **Параметры:** `comp` (CompItem)
- **Возвращает:** ничего
- **Использование:** Очистка неправильно размещенных изображений

## Валидация и проверки

### `isValidMaskLayer(layer, transitionsFolder)`
- **Назначение:** Проверка, является ли слой валидной маской
- **Параметры:** `layer` (Layer), `transitionsFolder` (FolderItem)
- **Возвращает:** `true` если валидна, `false` иначе
- **Особенность:** Автоматически исправляет label маски при необходимости
- **Использование:** При поиске и валидации масок

### `validateProjectStructure()`
- **Назначение:** Валидация структуры проекта при запуске
- **Параметры:** нет
- **Возвращает:** `true` если структура валидна, `false` иначе
- **Использование:** При запуске скрипта

### `findProjectFolder(folderName)`
- **Назначение:** Поиск папки проекта по имени
- **Параметры:** `folderName` (строка) - имя папки для поиска
- **Возвращает:** объект FolderItem или `null`
- **Использование:** Универсальная функция для поиска папок проекта (Transitions, VideoSrc, Maps.Work и т.д.)
- **НОВОЕ в v1.3 (2024):** Создана для устранения дублирования кода - заменяет 19+ дублирующихся блоков поиска папок
- **JSDoc:** Полностью задокументирована

### `findCompByName(compName)`
- **Назначение:** Поиск композиции по имени
- **Параметры:** `compName` (строка)
- **Возвращает:** объект CompItem или `null`
- **Использование:** Поиск композиций в проекте

## Вспомогательные функции

### `getMaskNumber(maskName)`
- **Назначение:** Извлечение номера из имени маски
- **Параметры:** `maskName` (строка)
- **Возвращает:** номер (число) или `null`
- **Использование:** При работе с масками

### `getImageLayerName(maskNumber)`
- **Назначение:** Получение имени слоя изображения по номеру маски
- **Параметры:** `maskNumber` (число)
- **Возвращает:** имя слоя (строка)
- **Использование:** При создании слоев изображений

### `getNextMeteoImageNumber(projectFolder)`
- **Назначение:** Получение следующего доступного номера для изображения
- **Параметры:** `projectFolder` (объект FolderItem)
- **Возвращает:** следующий номер (число)
- **Использование:** При импорте новых изображений

### `renameImageSource(imageItem)`
- **Назначение:** Переименование источника изображения
- **Параметры:** `imageItem` (FootageItem)
- **Возвращает:** ничего
- **Использование:** При импорте изображений

### `isImageInMapsTemp(layer)`
- **Назначение:** Проверка, находится ли изображение в папке Maps.Temp
- **Параметры:** `layer` (Layer)
- **Возвращает:** `true` если в Maps.Temp, `false` иначе
- **Использование:** При валидации слоев изображений

### `ScaleLayer(comp, layer, scaleExpression, isScaleDown)`
- **Назначение:** Применение масштабирования к слою
- **Параметры:** `comp` (CompItem), `layer` (Layer), `scaleExpression` (строка), `isScaleDown` (булево)
- **Возвращает:** ничего
- **Использование:** Масштабирование слоев

### `getScaleExpression(type)`
- **Назначение:** Получение выражения для масштабирования
- **Параметры:** `type` (строка: "up" или "down")
- **Возвращает:** выражение (строка)
- **Использование:** При масштабировании слоев

### `hasAllowedExtension(fileName, extensions)`
- **Назначение:** Проверка расширения файла
- **Параметры:** `fileName` (строка), `extensions` (массив строк)
- **Возвращает:** `true` если расширение разрешено, `false` иначе
- **Использование:** При импорте файлов

### `deselectFolderElements()`
- **Назначение:** Снятие выделения с элементов папки
- **Параметры:** нет
- **Возвращает:** ничего
- **Использование:** При работе с проектом

### `applyRenderTemplateWithFallback(outputModule, templateName, fallbackTemplate)`
- **Назначение:** Применение шаблона рендера с резервным вариантом
- **Параметры:** `outputModule` (OutputModule), `templateName` (строка), `fallbackTemplate` (строка)
- **Возвращает:** ничего
- **Использование:** При настройке рендера

### `clearSelection(comp)`
- **Назначение:** Очистка выделения в композиции
- **Параметры:** `comp` (CompItem)
- **Возвращает:** ничего
- **Использование:** При работе с композициями

### `showWarnings(warnings, comp)`
- **Назначение:** Отображение предупреждений пользователю
- **Параметры:** `warnings` (массив строк), `comp` (CompItem)
- **Возвращает:** ничего
- **Использование:** При валидации и размещении изображений

## Debug и профилирование (НОВОЕ в v1.3)

### `isLayerValid(obj)`
- **Назначение:** Проверка валидности объекта AE (слой, композиция и т.д.)
- **Параметры:** `obj` (объект AE)
- **Возвращает:** `true` если объект валиден, `false` если нет
- **Проверки:**
  - Проверка на `null` и `undefined`
  - Проверка наличия базовых свойств (`name`, `inPoint`)
  - Проверка свойства `isValid` (если доступно)
  - Обработка исключений при доступе к свойствам
- **Использование:** В `safeExecute()` для валидации аргументов в debug режиме
- **НОВОЕ в v1.3:** Добавлено для предотвращения работы с невалидными объектами

### `debugLog(message)`
- **Назначение:** Логирование сообщений только в debug режиме
- **Параметры:** `message` (строка)
- **Возвращает:** ничего
- **Использование:** Для детального логирования при отладке
- **НОВОЕ в v1.3:** Добавлено для debug режима

## Объекты и утилиты (НОВОЕ в v1.3)

### `UI_GETTERS` (объект)
- **Назначение:** Функции-геттеры для получения актуальных значений из UI
- **Свойства:**
  - `folderPath()` - путь к папке с изображениями
  - `backupPath()` - путь к папке бэкапа
  - `compName()` - имя композиции
  - `projectFolder()` - папка проекта
  - `videoProjectFolder()` - папка видео проекта
  - `videoInputPath()` - путь к входному видео
  - `videoOutputPath()` - путь к выходному видео
  - `renderTemplate1()` - шаблон рендера 1
  - `renderTemplate2()` - шаблон рендера 2
  - `isDebugMode()` - проверка включен ли debug режим
- **Использование:** Вместо глобальных переменных для предотвращения утечек памяти
- **НОВОЕ в v1.3:** Добавлено для предотвращения использования устаревших значений из UI

### `PerfTimer` (объект)
- **Назначение:** Профилирование производительности функций
- **Методы:**
  - `start(name)` - начало измерения (только в debug режиме)
  - `end(name)` - окончание измерения и вывод результата (только в debug режиме)
- **Использование:** Автоматически используется в `safeExecute()` для профилирования
- **НОВОЕ в v1.3:** Добавлено для отладки производительности

