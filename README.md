# Portfolio-MeteoCalendar

Проект: ExtendScript скрипт `MeteoCalendarAnim v1.3.jsx` для Adobe After Effects, автоматизирующий управление слайд-шоу и погодной рубрикой "Метеокалендарь".

## Описание

Скрипт автоматизирует ряд рутинных и однотипных процессов в проекте After Effects "Метеокалендарь":

- **Исключает ручную загрузку и размещение видео в проекте** — автоматический импорт и позиционирование видеоконтента.

- **Автоматически находит и применяет эффекты кеинга для видео с хромакейным фоном** — обработка видеоконтента ведущего с типовым зеленым фоном в один клик (Keylight, Matte Choker).

- **Обеспечивает автоматическую загрузку и применение масок к изображениям-слайдам** — умное размещение метеоизображений под соответствующими масками с автоматической сортировкой и валидацией.

- **Управление метеоизображениями** — импорт, размещение, масштабирование и трансформация слоев с метеорологическими данными.

- **Автоматическая очистка и управление проектом** — очистка слоев, папок, создание бэкапов и восстановление файлов.

- **Валидация структуры проекта** — автоматическая проверка корректности композиций и слоев при запуске.

- **Система отмены операций** — все действия поддерживают стандартную отмену через Ctrl+Z в After Effects.

- **Логирование и отладка** — полное логирование всех операций в файл с поддержкой debug-режима и профилирования производительности.

- **Скрипт рассчитан на работу с подготовленным строго под него AE-проектом**, что исключает ошибки, связанные с несовпадением структуры проекта.

- **Управляет рендерингом с заранее заданными путями сохранения файлов**, не требуя дополнительных настроек.

Такой уровень автоматизации позволяет значительно ускорить производство погодной рубрики и снизить количество ошибок при ручной обработке материала.

## Технические детали

- **Язык:** ExtendScript (JavaScript для After Effects)
- **Совместимость:** After Effects 2022 и выше (возможно, работает и на более ранних версиях)
- **Размер кода:** ~4404 строки
- **Количество функций:** 38+ функций

### Основные возможности API

- Работа с API After Effects: композиции, слои, выражения, рендеринг
- Методы работы с файлами и папками, контроль версий логов
- Модульная архитектура с разделением на функциональные блоки
- Взаимодействие с пользовательским интерфейсом в AE
- Безопасная обработка ошибок через централизованную систему `safeExecute`
- Валидация путей и защита от выполнения небезопасных команд

### Улучшения в версии 1.3

- ✅ Все магические числа вынесены в именованные константы
- ✅ Реализована система логирования с записью в файл
- ✅ Централизованная обработка ошибок
- ✅ Валидация структуры проекта при запуске
- ✅ Автоматическое исправление масок (label и имена)
- ✅ Система отмены операций (undo) для всех действий
- ✅ Восстановление файлов из бэкапа
- ✅ Debug-режим с профилированием производительности
- ✅ Улучшенная безопасность работы с BAT-файлами
- ✅ Полная JSDoc документация для всех функций
- ✅ Устранено дублирование кода (19+ блоков заменены на функцию `findProjectFolder()`)

## Структура проекта

```
MeteoCalendarAnim/
├── MeteoCalendarAnim v1.3.jsx    # Основной скрипт для запуска в After Effects
├── BAK/                           # Папка с резервными копиями предыдущих версий
├── Script Analytics/              # Документация и аналитика кода
│   ├── README.md                  # Описание структуры документации
│   ├── CHANGELOG.md               # История изменений
│   ├── CODE_MAP_v1.3.md          # Карта структуры кода
│   ├── Code_Audit_Report_v1.3.md # Отчет об аудите кода
│   ├── Functions_List_v1.3.md     # Список всех функций
│   ├── Security_Audit_v1.3.md     # Аудит безопасности
│   ├── Constants_Reference_v1.3.md # Справочник констант
│   └── Code_Quality_v1.3.md       # Оценка качества кода
└── script_log.txt                 # Лог-файл работы скрипта
```

## Файлы в репозитории

- `MeteoCalendarAnim v1.3.jsx` — основной скрипт для запуска в After Effects
- `Script Analytics/` — полная документация по структуре кода, функциям и безопасности
- `BAK/` — резервные копии предыдущих версий скрипта

## Запуск

1. Откройте Adobe After Effects
2. Откройте проект с нужными композициями (структура проекта должна соответствовать требованиям скрипта)
3. Запустите скрипт через **File > Scripts > Run Script File...**
4. Выберите файл `MeteoCalendarAnim v1.3.jsx`

### Требования к проекту

Скрипт работает с конкретной структурой AE-проекта, включающей:
- Композицию "MeteoCalendar Main Comp" (основная рабочая композиция)
- Композицию "Video" (для работы с видео)
- Композицию "MeteoCalendarOut" (финальная композиция для рендера)
- Композицию "MeteoCalendar Instagram" (для Instagram-версии)
- Слои с масками (формат: "MeteoMask 01", "MeteoMask 02" и т.д.)
- Слои для метеоизображений (формат: "MeteoImage 01", "MeteoImage 02" и т.д.)

При запуске скрипт автоматически проверяет структуру проекта и предупреждает о возможных проблемах.

## Документация

Подробная документация по коду, функциям, константам и безопасности находится в папке `Script Analytics/`. Рекомендуется ознакомиться с:

- `CODE_MAP_v1.3.md` — для понимания структуры кода и навигации
- `Functions_List_v1.3.md` — для поиска и понимания функций
- `Constants_Reference_v1.3.md` — для работы с константами проекта

## Безопасность

Скрипт включает несколько уровней защиты:
- Валидация путей перед выполнением операций
- Экранирование путей для BAT-файлов
- Проверка существования файлов перед операциями
- Централизованная обработка ошибок

## Логирование

Все операции скрипта логируются в файл `script_log.txt` в корне проекта. Лог включает:
- Временные метки всех операций
- Типы сообщений (INFO, ERROR, WARNING, SUCCESS, DEBUG, SYSTEM, ALERT)
- Детальную информацию об ошибках

В debug-режиме дополнительно доступно профилирование производительности функций.

---

**Автор:** Tannenspiel (Эдуард)  
**Версия:** 1.3  
**Дата:** Ноябрь 2024

